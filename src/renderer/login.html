<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Entrar</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data:;">
  <style>
    :root{
      --bg: #f6f8fc;
      --card: #ffffff;
      --border: #e8eef7;
      --muted: #64748b;
      --text: #0f2544;
      --primary: #1e40af;
      --primary-600: #1b3a9a;
      --shadow: 0 10px 24px rgba(21,78,210,.08);
      --radius: 16px;
      --radius-sm: 10px;
      --wrap-login: 420px;
      --wrap-cad:   520px;
    }
    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: Inter, system-ui, Segoe UI, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center;
      transition: width .2s ease, height .2s ease;
    }
    .wrap{
      width: min(var(--wrap-login), 94vw);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      transition: width .2s ease;
    }
    /* quando em modo cadastro, aumente a largura do card */
    .mode-cad .wrap{ width: min(var(--wrap-cad), 96vw); }

    .head{
      padding:14px 16px;
      border-bottom:1px solid var(--border);
      font-weight:800;
      letter-spacing:.2px;
    }
    .body{ padding:16px; }

    .tabs{ display:flex; gap:8px; margin-bottom:12px; }
    .tab{
      flex:1; padding:10px 12px; text-align:center; cursor:pointer;
      border:1px solid var(--border); background:#f7f9ff;
      border-radius:var(--radius-sm); user-select:none;
      transition: all .15s ease;
    }
    .tab.active{ background:#fff; border-color:#8ea7ff; box-shadow: inset 0 0 0 1px #8ea7ff; }

    .row{ display:flex; flex-direction:column; gap:6px; margin-bottom:12px; }
    label{ font-size:12px; color:#334155; }

    .input{
      width:100%;
      padding:12px 12px;
      border:1px solid #e5e7eb; border-radius:var(--radius-sm);
      outline:none; font-size:14px; background: #fff;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    .input:focus{ border-color:#8ea7ff; box-shadow:0 0 0 3px rgba(142,167,255,.25); }

    /* contêiner só do input (sem label) — alinha o olho */
    .pwd-wrap{ position:relative; }
    .pwd-wrap .input{ padding-right:44px; } /* espaço para o olho */
    .eye{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      cursor:pointer; opacity:.75; display:flex; align-items:center; justify-content:center;
      width:22px; height:22px; border-radius:50%;
    }
    .eye:hover{ background:#f1f5ff; opacity:1; }

    .row-inline{ display:flex; align-items:center; gap:8px; }
    .check{ width:16px; height:16px; cursor:pointer; }

    .button{
      width:100%; padding:12px; border:none; border-radius:var(--radius-sm);
      background:var(--primary); color:#fff; font-weight:600; font-size:14px;
      cursor:pointer; transition:background .15s ease, transform .02s ease;
    }
    .button:hover{ background:var(--primary-600); }
    .button:active{ transform: translateY(1px); }

    .muted{ color:var(--muted); font-size:12px; min-height:16px; }

    @media (max-width:360px){
      .tab{ padding:8px 10px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">Acesso</div>
    <div class="body">
      <div class="tabs">
        <div id="t-login" class="tab active">Entrar</div>
        <div id="t-cad" class="tab">Cadastrar</div>
      </div>

      <!-- LOGIN -->
      <div id="pane-login">
        <div class="row">
          <label for="lg-email">E-mail</label>
          <input id="lg-email" class="input" type="email" placeholder="seu@email.com" autocomplete="email" autofocus>
        </div>

        <div class="row">
          <label for="lg-senha">Senha</label>
          <div class="pwd-wrap">
            <input id="lg-senha" class="input" type="password" placeholder="Sua senha" autocomplete="current-password">
            <span id="lg-eye" class="eye" title="Mostrar/ocultar">
              <svg id="lg-eye-closed" width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M3 3l18 18" stroke="currentColor" stroke-width="2"/>
                <path d="M9.9 4.24A9.53 9.53 0 0112 4c5.5 0 9 5 9 8-.45.86-1.05 1.66-1.76 2.35" stroke="currentColor" stroke-width="2"/>
              </svg>
              <svg id="lg-eye-open" width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
          </div>
        </div>

        <div class="row-inline" style="margin-top:6px;margin-bottom:10px">
          <input id="lg-remember" class="check" type="checkbox">
          <label for="lg-remember">Lembrar e preencher automaticamente</label>
        </div>

        <div class="row"><button id="lg-btn" class="button">Entrar</button></div>
        <div id="lg-msg" class="muted"></div>
      </div>

      <!-- CADASTRO -->
      <div id="pane-cad" style="display:none">
        <div class="row">
          <label for="cd-nome">Nome completo</label>
          <input id="cd-nome" class="input" placeholder="Seu nome completo" autocomplete="name">
        </div>

        <div class="row">
          <label for="cd-email">E-mail</label>
          <input id="cd-email" class="input" type="email" placeholder="seu@email.com" autocomplete="email">
        </div>

        <div class="row">
          <label for="cd-cpf">CPF ou CNPJ</label>
          <input id="cd-cpf" class="input" placeholder="Somente números" autocomplete="off">
        </div>

        <div class="row">
          <label for="cd-senha">Senha</label>
          <div class="pwd-wrap">
            <input id="cd-senha" class="input" type="password" placeholder="Crie uma senha" autocomplete="new-password">
            <span id="cd-eye1" class="eye" title="Mostrar/ocultar">
              <svg id="cd-eye1-closed" width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M3 3l18 18" stroke="currentColor" stroke-width="2"/>
                <path d="M9.9 4.24A9.53 9.53 0 0112 4c5.5 0 9 5 9 8-.45.86-1.05 1.66-1.76 2.35" stroke="currentColor" stroke-width="2"/>
              </svg>
              <svg id="cd-eye1-open" width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
          </div>
        </div>

        <div class="row">
          <label for="cd-senha2">Confirmar senha</label>
          <div class="pwd-wrap">
            <input id="cd-senha2" class="input" type="password" placeholder="Repita a senha" autocomplete="new-password">
            <span id="cd-eye2" class="eye" title="Mostrar/ocultar">
              <svg id="cd-eye2-closed" width="18" height="18" viewBox="0 0 24 24" fill="none">
                <path d="M3 3l18 18" stroke="currentColor" stroke-width="2"/>
                <path d="M9.9 4.24A9.53 9.53 0 0112 4c5.5 0 9 5 9 8-.45.86-1.05 1.66-1.76 2.35" stroke="currentColor" stroke-width="2"/>
              </svg>
              <svg id="cd-eye2-open" width="18" height="18" viewBox="0 0 24 24" fill="none" style="display:none">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z" stroke="currentColor" stroke-width="2"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
          </div>
        </div>

        <div class="row"><button id="cd-btn" class="button">Cadastrar</button></div>
        <div id="cd-msg" class="muted"></div>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    // Abas e resize dinâmico
    const tLogin = document.getElementById('t-login');
    const tCad   = document.getElementById('t-cad');
    const pLogin = document.getElementById('pane-login');
    const pCad   = document.getElementById('pane-cad');

    function goLogin(){
      document.body.classList.remove('mode-cad');
      tLogin.classList.add('active'); tCad.classList.remove('active');
      pLogin.style.display='block';  pCad.style.display='none';
      // janela menor
      ipcRenderer.send('login:resize', { width: 460, height: 560 });
    }
    function goCadastro(){
      document.body.classList.add('mode-cad');
      tCad.classList.add('active'); tLogin.classList.remove('active');
      pLogin.style.display='none';  pCad.style.display='block';
      // janela maior
      ipcRenderer.send('login:resize', { width: 560, height: 720 });
    }
    tLogin.onclick = goLogin;
    tCad.onclick   = goCadastro;

    // Helpers UX
    function setMsg(id, txt, err=false){
      const el = document.getElementById(id);
      el.textContent = txt || '';
      el.style.color = err ? '#b91c1c' : '#64748b';
    }
    function togglePwd(inputId, eyeOpenId, eyeClosedId){
      const inp   = document.getElementById(inputId);
      const open  = document.getElementById(eyeOpenId);
      const close = document.getElementById(eyeClosedId);
      if (inp.type === 'password'){ inp.type = 'text'; open.style.display='inline'; close.style.display='none'; }
      else { inp.type = 'password'; open.style.display='none'; close.style.display='inline'; }
    }

    // Lembrar dados
    const REMEMBER_KEY = 'AUTH_REMEMBER';
    function loadRemember(){
      try {
        const j = JSON.parse(localStorage.getItem(REMEMBER_KEY) || '{}');
        if (j.on) {
          document.getElementById('lg-remember').checked = true;
          document.getElementById('lg-email').value = j.email || '';
          document.getElementById('lg-senha').value = j.senha || '';
        }
      } catch {}
    }
    function saveRemember(on, email, senha){
      try { localStorage.setItem(REMEMBER_KEY, JSON.stringify({ on, email, senha })); } catch {}
    }
    loadRemember();
    // inicia no layout compacto
    goLogin();

    // Olhos
    document.getElementById('lg-eye').onclick  = () => togglePwd('lg-senha','lg-eye-open','lg-eye-closed');
    document.getElementById('cd-eye1').onclick = () => togglePwd('cd-senha','cd-eye1-open','cd-eye1-closed');
    document.getElementById('cd-eye2').onclick = () => togglePwd('cd-senha2','cd-eye2-open','cd-eye2-closed');

    // Login
    document.getElementById('lg-btn').onclick = async () => {
      try{
        setMsg('lg-msg','Autenticando...');
        const email = document.getElementById('lg-email').value.trim();
        const senha = document.getElementById('lg-senha').value;
        const remember = document.getElementById('lg-remember').checked;

        if(!email || !senha) return setMsg('lg-msg','Informe e-mail e senha.', true);

        const out = await ipcRenderer.invoke('auth:signin', { email, senha, user_agent: navigator.userAgent || null });
        if(!out?.ok) return setMsg('lg-msg', out?.error || 'Falha ao entrar.', true);

        if (remember) saveRemember(true, email, senha); else saveRemember(false, '', '');

        ipcRenderer.send('auth:login:success', { token: out.token, user: out.user || null });
        setMsg('lg-msg','Ok! Abrindo...', false);
      }catch(err){ setMsg('lg-msg', err?.message || String(err), true); }
    };

    // Cadastro
    document.getElementById('cd-btn').onclick = async () => {
      try{
        setMsg('cd-msg','Criando conta...');
        const nome  = document.getElementById('cd-nome').value.trim();
        const email = document.getElementById('cd-email').value.trim();
        const cpf   = document.getElementById('cd-cpf').value.trim();
        const s1    = document.getElementById('cd-senha').value;
        const s2    = document.getElementById('cd-senha2').value;

        if(!nome || !email) return setMsg('cd-msg','Preencha nome e e-mail.', true);
        if(!s1 || !s2)      return setMsg('cd-msg','Informe e confirme a senha.', true);
        if(s1 !== s2)       return setMsg('cd-msg','As senhas não coincidem.', true);

        const out = await ipcRenderer.invoke('auth:signup', {
          nome, email, senha: s1, cpf_cnpj: cpf, user_agent: navigator.userAgent || null
        });
        if(!out?.ok) return setMsg('cd-msg', out?.error || 'Falha no cadastro.', true);

        ipcRenderer.send('auth:login:success', { token: out.token, user: out.user || null });
        setMsg('cd-msg','Conta criada! Abrindo...', false);
      }catch(err){ setMsg('cd-msg', err?.message || String(err), true); }
    };
  </script>
</body>
</html>
